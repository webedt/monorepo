version: '3.8'

services:
  main-server:
    build: .
    image: dockerregistry.etdofresh.com/main-server:latest
    ports:
      - "3000:3000"
    environment:
      PORT: 3000
      NODE_ENV: production
      # Database (external PostgreSQL)
      DATABASE_URL: ${DATABASE_URL}
      # MinIO configuration (use existing MinIO on network)
      MINIO_ENDPOINT: ${MINIO_ENDPOINT:-webedt-app-minio-0fslch}
      MINIO_PORT: ${MINIO_PORT:-9000}
      MINIO_USE_SSL: ${MINIO_USE_SSL:-false}
      MINIO_ROOT_USER: ${MINIO_ROOT_USER}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
      MINIO_BUCKET: ${MINIO_BUCKET:-sessions}
      # Session configuration
      SESSION_SECRET: ${SESSION_SECRET}
      # AI Worker
      AI_WORKER_URL: ${AI_WORKER_URL:-http://ai-coding-worker:5000}
      # CORS
      ALLOWED_ORIGINS: ${ALLOWED_ORIGINS}
      # GitHub OAuth
      GITHUB_CLIENT_ID: ${GITHUB_CLIENT_ID:-}
      GITHUB_CLIENT_SECRET: ${GITHUB_CLIENT_SECRET:-}
      # OpenAI (for transcription)
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    networks:
      - dokploy-network
    restart: unless-stopped

networks:
  dokploy-network:
    external: true
