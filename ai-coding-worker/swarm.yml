version: '3.8'

services:
  ai-coding-worker:
    image: dockerregistry.etdofresh.com/ai-coding-worker:latest
    ports:
      - target: 5000
        published: 5001
        protocol: tcp
        mode: ingress
    environment:
      - PORT=5000
      - TMP_DIR=/tmp
      - INTERNAL_API_URL=${INTERNAL_API_URL:-http://webedt-app-webedt-internal-api-server-juit1b:3000}
      - DB_BASE_URL=${DB_BASE_URL:-}
    networks:
      - dokploy-network
    deploy:
      replicas: 10
      restart_policy:
        condition: any
        delay: 0s
        max_attempts: 0
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
      update_config:
        parallelism: 1
        delay: 10s
        failure_action: rollback
      rollback_config:
        parallelism: 1
        delay: 10s

networks:
  dokploy-network:
    external: true
