version: '3.8'

services:
  ai-coding-worker:
    image: dockerregistry.etdofresh.com/ai-coding-worker:latest
    expose:
      - "5000"
    environment:
      - PORT=5000
      - TMP_DIR=/tmp
      - INTERNAL_API_URL=${INTERNAL_API_URL:-http://internal-api-server:3000}
      - DB_BASE_URL=${DB_BASE_URL:-}

    networks:
      - dokploy-network
    deploy:
      replicas: 10
      restart_policy:
        condition: any
        delay: 0s
        max_attempts: 0
      resources:
        limits:
          cpus: '1.0'
          memory: 4G
      update_config:
        parallelism: 1
        delay: 10s
        failure_action: rollback
      rollback_config:
        parallelism: 1
        delay: 10s

networks:
  dokploy-network:
    external: true
